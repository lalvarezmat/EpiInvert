---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# EpiInvert

<!-- badges: start -->
<!-- badges: end -->

EpiInvert estimates a time varying epidemic reproduction number and a restored 
incidence curve by inverting a renewal equation through a variational model as 
described in 
[PNAS, 2021](https://www.pnas.org/doi/10.1073/pnas.2105112118) and 
[Biology, 2022](https://www.mdpi.com/2079-7737/11/4/540). 
EpiInvert also corrects the administrative weekly bias in the daily registration 
of cases and the bias introduced by the festive days.

## Installation

You can install the development version of EpiInvert from [GitHub](https://github.com/) with:

```{r setup, eval=FALSE}
 install.packages("devtools")
 devtools::install_github("lalvarezmat/EpiInvert")
```

## Example
We attach some required package
```{r, echo = TRUE,message = FALSE }
library(EpiInvert)
library(ggplot2)
library(dplyr)
library(grid)
```  

We load data on COVID-19 daily incidence up to 2022-05-05 for France, 
Germany, the USA and UK: 
```{r}
data(incidence)
tail(incidence)
```
We load some festive days for the same countries: 
```{r}
data(festives)
head(festives)
```

We execute EpiInvert using Germany data:
```{r,echo = TRUE, message = FALSE,results = FALSE}
res <- EpiInvert(incidence$DEU,"2022-05-05",festives$DEU)
```

We plot the results: 
```{r fig1, fig.width = 6, fig.height = 10, fig.align = "center"}
plot(res)

```
The main outcomes of EpiInvert, illustrated in this figure, are : 

$~$

$\text{1. original incidence}\ (i^0_t)$

$\text{2. festive bias free incidence}\ (i^f_t):$  
The registration of daily cases is perturbed in the festive days. We correct this perturbation using the variational model by modifying the original incidence values in the festive days and the next 2 days. 

$\text{3. weekly + festive biases free incidence}\ (i^b_t=q_ti^f_t):$  
We use 
7-day quasi-periodic multiplicative factors to correct the administrative weekly
bias in the registration of daily cases. 

$\text{4. restored incidence}\ (i^r_t=\sum_k i^b_{t-k}R_{t-k}\Phi_k):$  
We compute a restored incidence curve by application of the renewal equation

$\text{5. Rt}\ (R_t):$  
Time varying reproduction number computed using the variational model. 

$\text{6. seasonality}\ (q_t):$ 
7-day quasi-periodic multiplicative factors to correct the administrative weekly bias in the registration of daily cases.

$\text{6. normalized noise}\ (\epsilon_t=\frac{i^b_t-i^r_t}{(i^r_t)^a}):$ 
We compute the difference between the bias corrected incidence curve and its expected value using the renewal equation noramlized by a power of the incidence. 

