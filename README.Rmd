---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# EpiInvert

<!-- badges: start -->
<!-- badges: end -->

EpiInvert estimates time varying epidemic reproduction numbers and restored 
incidence curves by inverting a renewal equation through a variational model as 
described in 
[PNAS, 2021](https://www.pnas.org/doi/10.1073/pnas.2105112118) and 
[Biology, 2022](https://www.mdpi.com/2079-7737/11/4/540). 
EpiInvert also corrects the administrative weekly bias in the daily registration 
of cases and the bias introduced by the festive days. 
(see [EpiInvert Vignette](https://ctim.ulpgc.es/covid19/EpiInvertVignette.html)
 for a more detailed description). 

## Installation

You can install the development version of EpiInvert from [GitHub](https://github.com/) with:

```{r setup, eval=FALSE}
 install.packages("devtools")
 devtools::install_github("lalvarezmat/EpiInvert")
```

## Example
We attach some required packages
```{r, echo = TRUE,message = FALSE }
library(EpiInvert)
library(ggplot2)
library(dplyr)
library(grid)
```  

Loading data on COVID-19 daily incidence up to 2022-05-05 for 
[France](https://www.santepubliquefrance.fr/dossiers/coronavirus-covid-19/coronavirus-chiffres-cles-et-evolution-de-la-covid-19-en-france-et-dans-le-monde), 
[Germany](https://experience.arcgis.com/experience/478220a4c454480e823b17327b2bf1d4), 
[the USA](https://ourworldindata.org/coronavirus-source-data) 
and [UK](https://ourworldindata.org/coronavirus-source-data): 
```{r}
data(incidence)
tail(incidence)
```

Loading some festive days for the same countries: 
```{r}
data(festives)
head(festives)
```

Executing EpiInvert using Germany data:
```{r,echo = TRUE, message = FALSE,results = FALSE}
res <- EpiInvert(incidence$DEU,"2022-05-05",festives$DEU)
```

Plotting the results: 
```{r fig1, fig.width = 6, fig.height = 10, fig.align = "center"}
EpiInvert_plot(res)

```
The main outcomes of EpiInvert, illustrated in this figure, are : 

$~$

$\text{1. original incidence}\ (i^0_t)$

--------

$\text{2. festive bias free incidence}\ (i^f_t):$  


The registration of daily cases is biased in the festive days. This bias is corrected by modifying the original incidence values in the festive days and the next 2 days. 

--------

$\text{3. weekly + festive biases free incidence}\ (i^b_t=q_ti^f_t):$  

Uses 7-day quasi-periodic multiplicative factors to correct the administrative weekly bias in the registration of daily cases. 

--------

$\text{4. restored incidence}\ (i^r_t=\sum_k i^b_{t-k}R_{t-k}\Phi_k):$  

Computes a restored incidence curve by application of the renewal equation

--------

$\text{5. Rt}\ (R_t):$  

Time varying reproduction number computed using the variational model. To 
calculate Rt on each day t, EpiInvert uses the past days (t'<=t) and the future 
days (t'>t) when available. Therefore, the EpiInvert estimate of Rt varies when 
there are more days available. In the above plot of Rt we show an empiric  95% 
confidence interval of the expected variation of Rt as a function of the number 
of available days after t..

--------

$\text{6. seasonality}\ (q_t):$ 

7-day quasi-periodic multiplicative factors to correct the administrative weekly bias in the registration of daily cases.

--------

$\text{7. normalized noise}\ (\epsilon_t=\frac{i^b_t-i^r_t}{(i^r_t)^a}):$ 

Computes the difference between the bias corrected incidence curve and its expected value using the renewal equation normalized by a power of the incidence. 



